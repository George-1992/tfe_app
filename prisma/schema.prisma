// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model accounts {
  id     String  @id @default(uuid())
  name   String  @default("Default Account")
  status String? @default("inactive")
  tokens Json?   @default("{}")

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  users_and_accounts users_and_accounts[]

  @@index([name])
  @@index([status])
}

model users {
  id         String   @id @default(cuid())
  status     String?  @default("active")
  email      String   @unique
  first_name String?  @default("")
  last_name  String?  @default("")
  password   String?
  provider   String?  @default("email")
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  users_and_accounts users_and_accounts[]
  tokens             tokens[]

  @@index([email])
  @@index([status])
  @@index([provider])
  @@index([first_name])
  @@index([last_name])
}

model users_and_accounts {
  id         String   @id @default(cuid())
  role       String
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  account_id String
  account    accounts @relation(fields: [account_id], references: [id])
  user_id    String
  user       users    @relation(fields: [user_id], references: [id])

  @@unique([account_id, user_id])
  @@index([account_id])
  @@index([user_id])
  @@index([role])
}

model tokens {
  id   String @id @default(cuid())
  name String @unique
  data Json   @default("{}")

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  users      users?   @relation(fields: [usersId], references: [id])
  usersId    String?

  @@index([name])
}

model forms {
  id                           String   @id @default(cuid())
  full_name                    String
  email                        String?
  phone                        String?
  is_business_quote            Boolean  @default(false)
  company_name                 String?
  project_address              String?
  has_sales_rep                Boolean  @default(false)
  sales_rep_email              String?
  timeframe                    String?
  material_choice              String?
  engineered_wood_install_type String?
  lvt_install_type             String?
  solid_wood_install_type      String?
  pattern_choice               String?
  tonality                     Int?     @default(0)
  price_range                  String?
  manual_price                 String?
  rooms                        Json     @default("[]")
  total_area                   String?
  uplift_required              Boolean  @default(false)
  flooring_types               Json     @default("[]")
  carpet_area                  String?
  wood_area                    String?
  subfloor_type                String?
  has_skirting_boards          Boolean  @default(false)
  skirting_finish              String?
  other_requirements           Json     @default("[]")
  is_area_cleared              Boolean  @default(false)
  manual_accessories           Json     @default("[]")
  understands_estimate         Boolean  @default(true)
  agrees_to_emails             Boolean  @default(false)
  notes                        String?
  utm_source                   String?
  utm_campaign                 String?
  utm_medium                   String?
  submission_date              DateTime @default(now())

  data       Json     @default("{}")
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
}

model contacts {
  id                String    @id @default(cuid())
  ghl_id            String?   @unique
  location_id       String?
  contact_name      String?
  first_name        String?
  last_name         String?
  first_name_raw    String?
  last_name_raw     String?
  company_name      String?
  email             String?   @unique
  phone             String?   @unique
  dnd               Boolean   @default(false)
  dnd_settings      Json?     @default("{}")
  type              String?   @default("lead")
  source            String?
  assigned_to       String?
  city              String?
  state             String?
  postal_code       String?
  address1          String?
  date_added        DateTime?
  date_updated      DateTime?
  date_of_birth     DateTime?
  business_id       String?
  tags              Json?     @default("[]")
  followers         Json?     @default("[]")
  country           String?
  website           String?
  timezone          String?
  profile_photo     String?
  additional_emails Json?     @default("[]")
  custom_fields     Json?     @default("[]")

  messages messages[]

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@index([ghl_id])
  @@index([email])
  @@index([phone])
  @@index([location_id])
  @@index([type])
  @@index([date_added])
}

model messages {
  id                       String    @id @default(cuid())
  role                     String?   @default("user")
  ghl_id                   String?   @unique
  type                     String?
  message_id               String?
  trace_id                 String?
  location_id              String?
  version_id               String?
  app_id                   String?
  attachments              Json?     @default("[]")
  body                     String?   @db.Text
  content_type             String?
  conversation_id          String?
  date_added               DateTime?
  direction                String?
  message_type             String?
  user_id                  String?
  status                   String?
  source                   String?
  conversation_provider_id String?
  timestamp                DateTime?
  webhook_id               String?

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  contact_id String?
  contact    contacts? @relation(fields: [contact_id], references: [id], onDelete: Cascade)

  @@index([ghl_id])
  @@index([contact_id])
  @@index([conversation_id])
  @@index([location_id])
  @@index([direction])
  @@index([date_added])
  @@index([status])
}
